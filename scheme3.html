<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <title>Schemat maszyn — lista kompaktowa</title>
    <link rel="stylesheet" href="content.css" />
    <style>
        :root {
            --panel-radius: 8px;
            --panel-border: 1px solid #c6c9d1;
            --panel-bg: #fff;
            --panel-text: #0f1b2d;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 12px;
            background: #fff;
            font-family: "FrutigerNeue Light", system-ui, sans-serif;
            color: var(--panel-text);
        }
        .card-layout { display: grid; grid-template-rows: auto 1fr; gap: 12px; }
        .cardheader-box {
            background: #f5f6f8;
            border: 1px solid #c6c9d1;
            border-radius: 8px 8px 0 0;
            padding: 12px 16px 10px;
        }
        .cardheader-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .field { display: flex; flex-direction: column; gap: 6px; }
        .button-bar { display: flex; align-items: center; gap: 8px; margin-top: 4px; }
        .button-group { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .icon-actions { display: flex; align-items: center; gap: 8px; margin-left: auto; }
        .icon-btn {
            border: 1px solid #c6c9d1;
            background: #fff;
            border-radius: 6px;
            width: 24px;
            height: 24px;
            padding: 3px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: box-shadow .12s ease, transform .12s ease;
        }
        .icon-btn:hover { box-shadow: 0 2px 6px rgba(0,0,0,0.08); transform: translateY(-1px); }
        .icon-btn img { width: 18px; height: 18px; display: block; }
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15,27,45,0.36);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 1000;
        }
        .modal-backdrop.is-visible { display: flex; }
        .modal {
            background: #fff;
            border: 1px solid #c6c9d1;
            border-radius: 12px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 12px 36px rgba(0,0,0,0.18);
            padding: 16px;
        }
        .modal-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .modal-title {
            font-size: 16px;
            font-weight: 800;
            color: #0f1b2d;
        }
        .modal-close {
            border: none;
            background: transparent;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 8px 12px;
        }

        .panel {
            position: relative;
            background: var(--panel-bg);
            border: var(--panel-border);
            border-radius: var(--panel-radius);
            min-height: 96px;
            padding: 12px;
        }
        .panel-label {
            position: absolute;
            top: -10px;
            left: 16px;
            padding: 0 8px;
            background: var(--panel-bg);
            font-weight: 800;
            font-size: 14px;
            color: #444;
        }
        .panel-content { padding-top: 8px; }

        .group-table {
            border: 1px solid #d2d8e5;
            border-radius: 10px;
            overflow: hidden;
            background: #fff;
            box-shadow: 0 6px 16px rgba(15,27,45,0.05);
        }
        .group-head {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f5f6f8;
            border-bottom: 1px solid #d2d8e5;
        }
        .group-thumb {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            object-fit: cover;
            border: 1px solid #d2d8e5;
        }
        .group-title { font-size: 16px; font-weight: 800; color: #0f1b2d; }
        .group-meta { font-size: 12px; color: #555; display: flex; flex-wrap: wrap; gap: 8px 12px; }
        .badge-row { display: flex; flex-wrap: wrap; gap: 6px; justify-content: flex-end; }
        .badge {
            padding: 6px 8px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            border: 1px solid #d7def1;
            background: #eef2fb;
            color: #0f1b2d;
        }
        .badge.status--active { background: rgba(60,140,255,0.15); border-color: rgba(60,140,255,0.25); color: #0c4a9a; }
        .badge.status--inactive { background: rgba(255,65,65,0.15); border-color: rgba(255,65,65,0.25); color: #9a0c0c; }
        .badge.status--service { background: rgba(255,165,70,0.18); border-color: rgba(255,165,70,0.3); color: #9a5a0c; }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        thead tr { background: #fafbfe; }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #eef1f6;
            text-align: left;
        }
        tbody tr:hover { background: #f7f9ff; }
        .status-pill {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            border: 1px solid #d7def1;
            background: #eef2fb;
            color: #0f1b2d;
        }
        .status-pill.status--inactive { background: rgba(255,65,65,0.15); border-color: rgba(255,65,65,0.25); color: #9a0c0c; }
        .status-pill.status--service { background: rgba(255,165,70,0.18); border-color: rgba(255,165,70,0.3); color: #9a5a0c; }
        .status-pill.status--active { background: rgba(60,140,255,0.15); border-color: rgba(60,140,255,0.25); color: #0c4a9a; }
        .tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 10px;
            background: #f0f3f8;
            border: 1px solid #dce1ec;
            font-size: 11px;
            color: #0f1b2d;
        }
        .table-wrap { overflow-x: auto; }
        .thumb-mini {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px solid #d2d8e5;
        }
    </style>
</head>
<body>
<div class="card-layout">
    <div class="cardheader-box">
        <div class="panel-content">
            <div class="cardheader-grid">
                <div class="field">
                    <label style="font-weight: 800; font-family: 'FrutigerNeue LTW1G Regular','FrutigerNeue Light',system-ui,sans-serif;">Schemat maszyn — lista</label>
                    <div class="button-bar">
                        <div class="button-group" style="margin-left:12px;">
                            <button class="content-btn content-btn-activate" type="button" style="padding:6px 12px; display:flex; align-items:center; gap:8px;">
                                <img src="svg-folder/CardViewIcon.svg" alt="" style="width:16px;height:16px;">
                                <span>Otwórz</span>
                            </button>
                            <button class="content-btn content-btn-activate" type="button" style="padding:6px 12px; display:flex; align-items:center; gap:8px;">
                                <img src="svg-folder/EditIcon.svg" alt="" style="width:16px;height:16px;">
                                <span>Edytuj</span>
                            </button>
                            <button class="content-btn content-btn-add" type="button" style="padding:6px 12px; display:flex; align-items:center; gap:8px;">
                                <img src="svg-folder/AddIcon.svg" alt="" style="width:16px;height:16px;">
                                <span>Dodaj</span>
                            </button>
                        </div>
                        <div class="icon-actions">
                            <button class="icon-btn" type="button" aria-label="Eksport do XLS">
                                <img src="svg-folder/ExcelIcon.svg" alt="XLS">
                            </button>
                            <button class="icon-btn" type="button" aria-label="Eksport do PDF">
                                <img src="svg-folder/PDFIcon.svg" alt="PDF">
                            </button>
                            <button id="filterToggle" class="icon-btn" type="button" aria-label="Filtruj">
                                <img src="svg-folder/FilterIcon.svg" alt="Filtruj">
                            </button>
                            <button id="settingsToggle" class="icon-btn" type="button" aria-label="Ustawienia kolumn">
                                <img src="svg-folder/SettingsIcon.svg" alt="Ustawienia">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <div class="modal-backdrop" id="settingsModal">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
            <div class="modal-head">
                <div class="modal-title" id="settingsTitle">Widoczne kolumny</div>
                <button class="modal-close" type="button" aria-label="Zamknij" id="settingsClose">✕</button>
            </div>
            <div class="checkbox-grid">
                <label class="menu-check"><input type="checkbox" checked />Nazwa</label>
                <label class="menu-check"><input type="checkbox" checked />Skrót</label>
                <label class="menu-check"><input type="checkbox" checked />Nr Inwetarzowy</label>
                <label class="menu-check"><input type="checkbox" checked />Wydział</label>
                <label class="menu-check"><input type="checkbox" checked />Lokalizacja</label>
                <label class="menu-check"><input type="checkbox" checked />Producent</label>
                <label class="menu-check"><input type="checkbox" checked />Model</label>
                <label class="menu-check"><input type="checkbox" checked />Data upływu gwarancji</label>
                <label class="menu-check"><input type="checkbox" checked />Status</label>
                <label class="menu-check"><input type="checkbox" checked />Status operacyjny</label>
                <label class="menu-check"><input type="checkbox" checked />Maszyna nadrzędna</label>
            </div>
        </div>
    </div>

    <div class="modal-backdrop" id="filterModal">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="filterTitle">
            <div class="modal-head">
                <div class="modal-title" id="filterTitle">Wyświetl maszyny:</div>
                <button class="modal-close" type="button" aria-label="Zamknij" id="filterClose">✕</button>
            </div>
            <div class="checkbox-grid" style="margin-bottom:12px;">
                <label class="menu-check"><input type="checkbox" />Aktywne</label>
                <label class="menu-check"><input type="checkbox" />Nieaktywne</label>
                <label class="menu-check"><input type="checkbox" />Operacyjne</label>
                <label class="menu-check"><input type="checkbox" />Wycofane</label>
                <label class="menu-check"><input type="checkbox" />Tylko pod moim nadzorem</label>
                <label class="menu-check"><input type="checkbox" />W serwisie</label>
                <label class="menu-check"><input type="checkbox" />Zepsute</label>
                <label class="menu-check"><input type="checkbox" />Do wyrzucenia</label>
                <label class="menu-check"><input type="checkbox" />Bez zdjęć</label>
                <label class="menu-check"><input type="checkbox" />Po gwarancji</label>
                <label class="menu-check"><input type="checkbox" />W Leasingu</label>
            </div>
            <div class="field" style="margin-bottom:10px;">
                <label style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" />
                    <span>Powiązane z zadaniem:</span>
                </label>
                <select class="status-select">
                    <option>Zadanie A</option>
                    <option>Zadanie B</option>
                    <option>Zadanie C</option>
                </select>
            </div>
            <div class="field" style="margin-bottom:10px;">
                <label style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" />
                    <span>Odpowiedzialny:</span>
                </label>
                <select class="status-select">
                    <option>Ja</option>
                    <option>Jan</option>
                    <option>Janek</option>
                </select>
            </div>
            <div class="field">
                <label style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" />
                    <span>Z etykietą:</span>
                </label>
                <select class="status-select">
                    <option>E1</option>
                    <option>E2</option>
                    <option>E3</option>
                </select>
            </div>
        </div>
    </div>
    </div>

    <div class="panel panel--tall">
        <span class="panel-label">Schemat (lista)</span>
        <div class="panel-content">
            <div id="tables"></div>
        </div>
    </div>
</div>

<script>
const data = [
    {
        parent: { name:"Robot A", short:"RB-01", inv:"2001", dept:"Wydział robotów", loc:"Hala 1", maker:"ABB", model:"IRB 6700", warranty:"2026-03-05", status:"aktywny", op:"Operacyjna", thumb:"pictures/m3_thumb.jpg" },
        children: [
            { name:"Maszyna skrawająca 01", short:"MS-01", inv:"1001", dept:"Wydział maszyn", loc:"Hala 1", maker:"Mazak", model:"Integrex i-200", warranty:"2025-12-31", status:"aktywny", op:"Operacyjna", parent:"Robot A", thumb:"pictures/m1_thumb.jpg" },
            { name:"Robot 1", short:"RB-01", inv:"2001", dept:"Wydział robotów", loc:"Hala 1", maker:"ABB", model:"IRB 6700", warranty:"2026-03-05", status:"aktywny", op:"Operacyjna", parent:"Robot A", thumb:"pictures/m3_thumb.jpg" }
        ]
    },
    {
        parent: { name:"Robot B", short:"RB-02", inv:"2002", dept:"Wydział robotów", loc:"Hala 2", maker:"Fanuc", model:"M-20iA", warranty:"2025-06-20", status:"aktywny", op:"Operacyjna", thumb:"pictures/m4_thumb.jpg" },
        children: [
            { name:"Maszyna nieskrawająca 02", short:"MN-02", inv:"1002", dept:"Wydział robotów", loc:"Hala 2", maker:"KUKA", model:"KR 10", warranty:"2024-09-15", status:"aktywny", op:"Operacyjna", parent:"Robot B", thumb:"pictures/m2_thumb.jpg" },
            { name:"Robot 2", short:"RB-02", inv:"2002", dept:"Wydział robotów", loc:"Hala 2", maker:"Fanuc", model:"M-20iA", warranty:"2025-06-20", status:"aktywny", op:"Operacyjna", parent:"Robot B", thumb:"pictures/m4_thumb.jpg" },
            { name:"Wózek widłowy", short:"WW-01", inv:"3001", dept:"Wydział maszyn", loc:"Magazyn", maker:"Linde", model:"E16", warranty:"2024-11-30", status:"nieaktywny", op:"Serwis", parent:"Robot B", thumb:"pictures/m5_thumb.jpg" }
        ]
    }
];

function statusClass(status) {
    const val = (status || "").toLowerCase();
    if (val.includes("nieaktywn")) return "status--inactive";
    if (val.includes("serwis") || val.includes("rezerwa") || val.includes("wycof")) return "status--service";
    return "status--active";
}

function renderGroup(item) {
    const parent = item.parent;
    const rows = item.children.map(ch => `
        <tr>
            <td><img class="thumb-mini" src="${ch.thumb}" alt="${ch.name}"></td>
            <td>${ch.name}</td>
            <td>${ch.short}</td>
            <td>${ch.inv}</td>
            <td>${ch.dept}</td>
            <td>${ch.loc}</td>
            <td>${ch.maker} ${ch.model}</td>
            <td>${ch.warranty}</td>
            <td><span class="status-pill ${statusClass(ch.status)}">${ch.status}</span></td>
            <td><span class="tag">${ch.op}</span></td>
            <td>${ch.parent}</td>
        </tr>
    `).join("");

    return `
        <div class="group-table">
            <div class="group-head">
                <img class="group-thumb" src="${parent.thumb}" alt="${parent.name}">
                <div>
                    <div class="group-title">${parent.name}</div>
                    <div class="group-meta">
                        <span>${parent.short}</span>
                        <span>Inv: ${parent.inv}</span>
                        <span>${parent.dept}</span>
                        <span>${parent.loc}</span>
                        <span>${parent.maker} ${parent.model}</span>
                        <span>Gwarancja: ${parent.warranty}</span>
                    </div>
                </div>
                <div class="badge-row">
                    <span class="badge ${statusClass(parent.status)}">${parent.status}</span>
                    <span class="badge">${parent.op}</span>
                </div>
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th>Nazwa</th>
                            <th>Skrót</th>
                            <th>Inv</th>
                            <th>Wydział</th>
                            <th>Lokalizacja</th>
                            <th>Producent / model</th>
                            <th>Gwarancja</th>
                            <th>Status</th>
                            <th>Operacyjny</th>
                            <th>Nadrzędna</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rows}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

const tablesWrap = document.getElementById("tables");
if (tablesWrap) {
    tablesWrap.innerHTML = data.map(renderGroup).join("");
}

// Modale: ustawienia kolumn / filtry (jak w scheme.html)
const settingsToggle = document.getElementById("settingsToggle");
const settingsModal = document.getElementById("settingsModal");
const settingsClose = document.getElementById("settingsClose");

const filterToggle = document.getElementById("filterToggle");
const filterModal = document.getElementById("filterModal");
const filterClose = document.getElementById("filterClose");

function setModalVisibility(modalEl, open) {
    if (!modalEl) return;
    modalEl.classList.toggle("is-visible", open);
}

if (settingsToggle && settingsModal) {
    settingsToggle.addEventListener("click", () => setModalVisibility(settingsModal, true));
}
if (settingsClose && settingsModal) {
    settingsClose.addEventListener("click", () => setModalVisibility(settingsModal, false));
}
if (settingsModal) {
    settingsModal.addEventListener("click", (e) => {
        if (e.target === settingsModal) setModalVisibility(settingsModal, false);
    });
}

if (filterToggle && filterModal) {
    filterToggle.addEventListener("click", () => setModalVisibility(filterModal, true));
}
if (filterClose && filterModal) {
    filterClose.addEventListener("click", () => setModalVisibility(filterModal, false));
}
if (filterModal) {
    filterModal.addEventListener("click", (e) => {
        if (e.target === filterModal) setModalVisibility(filterModal, false);
    });
}
</script>
</body>
</html>
