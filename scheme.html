<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <title>Schemat maszyn — kompakt</title>
    <link rel="stylesheet" href="content.css" />
    <style>
        :root {
            --panel-radius: 8px;
            --panel-border: 1px solid #c6c9d1;
            --panel-bg: #fff;
            --panel-text: #0f1b2d;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 12px;
            background: #fff;
            font-family: "FrutigerNeue Light", system-ui, sans-serif;
            color: var(--panel-text);
        }
        .card-layout {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 12px;
        }
        .cardheader-box {
            background: #f5f6f8;
            border: 1px solid #c6c9d1;
            border-radius: 8px 8px 0 0;
            padding: 12px 16px 10px;
        }
        .cardheader-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        .field { display: flex; flex-direction: column; gap: 6px; }
        .button-bar { display: flex; align-items: center; gap: 8px; margin-top: 4px; }
        .button-group { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .icon-actions { display: flex; align-items: center; gap: 8px; margin-left: auto; }
        .icon-btn {
            border: none;
            background: transparent;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform .1s ease, background-color .15s ease;
        }
        .icon-btn:hover { background: rgba(0,0,0,0.05); }
        .icon-btn:active { transform: scale(.97); box-shadow: 0 0 0 1px rgba(0,0,0,0.3); }
        .icon-btn img {
            width: 16px;
            height: 16px;
            display: block;
            transition: opacity .15s ease;
        }
        .icon-btn:hover img { opacity: .6; }
        .icon-divider {
            width: 1px;
            height: 24px;
            background: #c6c9d1;
        }
        .search-input {
            height: 32px;
            padding: 6px 10px;
            border: 1px solid #c6c9d1;
            border-radius: 6px;
            font-size: 13px;
            min-width: 180px;
        }
        .menu-check {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font: inherit;
            font-weight: 600;
            color: #0f1b2d;
        }
        .menu-check input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
            appearance: checkbox;
            -webkit-appearance: checkbox;
            -moz-appearance: checkbox;
            accent-color: #1f2937;
            cursor: pointer;
        }
        .filter-checkbox {
            width: 16px;
            height: 16px;
            margin: 0;
            appearance: checkbox;
            -webkit-appearance: checkbox;
            -moz-appearance: checkbox;
            accent-color: #1f2937;
            cursor: pointer;
        }
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15,27,45,0.36);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 1000;
        }
        .modal-backdrop.is-visible { display: flex; }
        .modal {
            background: #fff;
            border: 1px solid #c6c9d1;
            border-radius: 12px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 12px 36px rgba(0,0,0,0.18);
            padding: 16px;
        }
        .modal-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .modal-title {
            font-size: 16px;
            font-weight: 800;
            color: #0f1b2d;
        }
        .modal-close {
            border: none;
            background: transparent;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 8px 12px;
        }

        .panel {
            position: relative;
            background: var(--panel-bg);
            border: var(--panel-border);
            border-radius: var(--panel-radius);
            min-height: 96px;
            padding: 12px;
        }
        .panel-label {
            position: absolute;
            top: -10px;
            left: 16px;
            padding: 0 8px;
            background: var(--panel-bg);
            font-weight: 800;
            font-size: 14px;
            color: #444;
        }
        .panel-content { padding-top: 8px; }

        .groups {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .group {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 12px;
            align-items: start;
        }
        .parent-card,
        .child-card {
            border: 1px solid #d2d8e5;
            border-radius: 10px;
            background: #fff;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 6px 16px rgba(15,27,45,0.05);
        }
        .is-selected {
            border-color: #9bb7ff;
            box-shadow: 0 0 0 1px #9bb7ff inset, 0 6px 16px rgba(15,27,45,0.08);
        }
        .is-editing .parent-card,
        .is-editing .child-card {
            border-color: #d22;
            box-shadow: 0 0 0 1px rgba(210,34,34,0.35);
        }
        .card-head {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .thumb {
            width: 56px;
            height: 56px;
            border-radius: 10px;
            object-fit: cover;
            border: 1px solid #d2d8e5;
        }
        .title {
            font-size: 16px;
            font-weight: 800;
            color: #0f1b2d;
        }
        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px 12px;
            font-size: 12px;
            color: #555;
        }
        .meta span { white-space: nowrap; }
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .tag {
            padding: 6px 8px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            border: 1px solid rgba(0,0,0,0.08);
            background: #f7f8fb;
            color: #0f1b2d;
        }
        .tag.status--active { background: rgba(60,140,255,0.15); border-color: rgba(60,140,255,0.2); color: #0c4a9a; }
        .tag.status--inactive { background: rgba(255,65,65,0.15); border-color: rgba(255,65,65,0.2); color: #9a0c0c; }
        .tag.status--service { background: rgba(255,165,70,0.18); border-color: rgba(255,165,70,0.3); color: #9a5a0c; }
        .pill.status--active { background: rgba(60,140,255,0.15); border-color: rgba(60,140,255,0.2); color: #0c4a9a; }
        .pill.status--inactive { background: rgba(255,65,65,0.15); border-color: rgba(255,65,65,0.2); color: #9a0c0c; }
        .pill.status--service { background: rgba(255,165,70,0.18); border-color: rgba(255,165,70,0.3); color: #9a5a0c; }

        .children-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 10px;
        }
        .child-card .title { font-size: 14px; }
        .child-card .meta { font-size: 11px; }
        .pill-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .pill {
            padding: 4px 8px;
            border-radius: 12px;
            background: #f0f3f8;
            font-size: 11px;
            color: #0f1b2d;
            border: 1px solid #dce1ec;
        }
    </style>
</head>
<body>
<div class="card-layout">
    <div class="cardheader-box">
        <div class="panel-content">
            <div class="cardheader-grid">
                <div class="field">
                    <label style="font-weight: 800; font-family: 'FrutigerNeue LTW1G Regular','FrutigerNeue Light',system-ui,sans-serif;">Schemat maszyn — kompakt</label>
                    <div class="button-bar">
                        <div class="button-group" style="margin-left:12px;">
                            <button id="openCardBtnScheme" class="content-btn content-btn-activate" type="button" style="padding:6px 12px; display:flex; align-items:center; gap:8px;">
                                <img src="svg-folder/CardViewIcon.svg" alt="" style="width:16px;height:16px;">
                                <span>Otwórz</span>
                            </button>
                            <button id="editToggleBtn" class="content-btn content-btn-activate" type="button" style="padding:6px 12px; display:flex; align-items:center; gap:8px;">
                                <img src="svg-folder/EditIcon.svg" alt="" style="width:16px;height:16px;">
                                <span id="editToggleLabel">Edytuj</span>
                            </button>
                            <button class="content-btn content-btn-activate" type="button" style="padding:6px 12px; display:flex; align-items:center; gap:8px;">
                                <img src="svg-folder/DuplicateIcon.svg" alt="" style="width:16px;height:16px;">
                                <span>Duplikuj</span>
                            </button>
                            <button id="deleteMachineBtnScheme" class="content-btn content-btn-danger" type="button" style="padding:6px 12px; display:flex; align-items:center; gap:8px; background:#ffe5e5; border:1px solid #d22; color:#b00000;">
                                <img src="svg-folder/DeleteIcon.svg" alt="" style="width:16px;height:16px;">
                                <span>Usuń maszynę</span>
                            </button>
                            <span style="display:inline-block; width:1px; height:28px; background:#c6c9d1; margin:0 8px;"></span>
                            <button class="content-btn content-btn-add" type="button" style="padding:6px 12px; display:flex; align-items:center; gap:8px;">
                                <img src="svg-folder/AddIcon.svg" alt="" style="width:16px;height:16px;">
                                <span>Dodaj nową maszynę</span>
                            </button>
                        </div>
                        <div class="icon-actions">
                            <input id="schemaSearch" class="search-input" type="search" placeholder="Szukaj..." aria-label="Szukaj w schemacie">
                            <button id="filterToggle" class="icon-btn" type="button" aria-label="Filtruj">
                                <img src="svg-folder/FilterIcon.svg" alt="Filtruj">
                            </button>
                            <button id="settingsToggle" class="icon-btn" type="button" aria-label="Ustawienia kolumn">
                                <img src="svg-folder/SettingsIcon.svg" alt="Ustawienia">
                            </button>
                            <span class="icon-divider" aria-hidden="true"></span>
                            <button class="icon-btn" type="button" aria-label="Eksport do XLS">
                                <img src="svg-folder/ExcelIcon.svg" alt="XLS">
                            </button>
                            <button class="icon-btn" type="button" aria-label="Eksport do PDF">
                                <img src="svg-folder/PDFIcon.svg" alt="PDF">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel panel--tall">
        <span class="panel-label">Schemat (kompakt)</span>
        <div class="panel-content">
            <div class="groups" id="groups"></div>
        </div>
    </div>
</div>

<div class="modal-backdrop" id="settingsModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
        <div class="modal-head">
            <div class="modal-title" id="settingsTitle">Widoczne kolumny</div>
            <button class="modal-close" type="button" aria-label="Zamknij" id="settingsClose">✕</button>
        </div>
        <div class="checkbox-grid">
            <label class="menu-check"><input type="checkbox" checked />Nazwa</label>
            <label class="menu-check"><input type="checkbox" checked />Skrót</label>
            <label class="menu-check"><input type="checkbox" checked />Nr Inwetarzowy</label>
            <label class="menu-check"><input type="checkbox" checked />Wydział</label>
            <label class="menu-check"><input type="checkbox" checked />Lokalizacja</label>
            <label class="menu-check"><input type="checkbox" checked />Producent</label>
            <label class="menu-check"><input type="checkbox" checked />Model</label>
            <label class="menu-check"><input type="checkbox" checked />Data upływu gwarancji</label>
            <label class="menu-check"><input type="checkbox" checked />Status</label>
            <label class="menu-check"><input type="checkbox" checked />Status operacyjny</label>
            <label class="menu-check"><input type="checkbox" checked />Maszyna nadrzędna</label>
        </div>
    </div>
</div>

<div class="modal-backdrop" id="filterModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="filterTitle">
        <div class="modal-head">
            <div class="modal-title" id="filterTitle">Wyświetl maszyny:</div>
            <button class="modal-close" type="button" aria-label="Zamknij" id="filterClose">✕</button>
        </div>
        <div class="checkbox-grid" style="margin-bottom:12px;">
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Aktywne</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Nieaktywne</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Operacyjne</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Wycofane</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Tylko pod moim nadzorem</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />W serwisie</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Zepsute</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Do wyrzucenia</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Bez zdjęć</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />Po gwarancji</label>
            <label class="menu-check"><input type="checkbox" class="filter-checkbox" />W Leasingu</label>
        </div>
        <div class="field" style="margin-bottom:10px;">
            <label style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" class="filter-checkbox" />
                <span>Powiązane z zadaniem:</span>
            </label>
            <select class="status-select">
                <option>Zadanie A</option>
                <option>Zadanie B</option>
                <option>Zadanie C</option>
            </select>
        </div>
        <div class="field" style="margin-bottom:10px;">
            <label style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" class="filter-checkbox" />
                <span>Odpowiedzialny:</span>
            </label>
            <select class="status-select">
                <option>Ja</option>
                <option>Jan</option>
                <option>Janek</option>
            </select>
        </div>
        <div class="field">
            <label style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" class="filter-checkbox" />
                <span>Z etykietą:</span>
            </label>
            <select class="status-select">
                <option>E1</option>
                <option>E2</option>
                <option>E3</option>
            </select>
        </div>
    </div>
</div>

<script>
const groups = [
    {
        parent: {
            name: "Robot A",
            short: "RB-01",
            inv: "2001",
            dept: "Wydział robotów",
            loc: "Hala 1",
            maker: "ABB",
            model: "IRB 6700",
            warranty: "2026-03-05",
            status: "aktywny",
            op: "Operacyjna",
            thumb: "pictures/m3_thumb.jpg"
        },
        children: [
            { name: "Maszyna skrawająca 01", short:"MS-01", inv:"1001", dept:"Wydział maszyn", loc:"Hala 1", maker:"Mazak", model:"Integrex i-200", warranty:"2025-12-31", status:"aktywny", op:"Operacyjna", parent:"Robot A", thumb:"pictures/m1_thumb.jpg" },
            { name: "Robot 1", short:"RB-01", inv:"2001", dept:"Wydział robotów", loc:"Hala 1", maker:"ABB", model:"IRB 6700", warranty:"2026-03-05", status:"aktywny", op:"Operacyjna", parent:"Robot A", thumb:"pictures/m3_thumb.jpg" }
        ]
    },
    {
        parent: {
            name: "Robot B",
            short: "RB-02",
            inv: "2002",
            dept: "Wydział robotów",
            loc: "Hala 2",
            maker: "Fanuc",
            model: "M-20iA",
            warranty: "2025-06-20",
            status: "aktywny",
            op: "Operacyjna",
            thumb: "pictures/m4_thumb.jpg"
        },
        children: [
            { name: "Maszyna nieskrawająca 02", short:"MN-02", inv:"1002", dept:"Wydział robotów", loc:"Hala 2", maker:"KUKA", model:"KR 10", warranty:"2024-09-15", status:"aktywny", op:"Operacyjna", parent:"Robot B", thumb:"pictures/m2_thumb.jpg" },
            { name: "Robot 2", short:"RB-02", inv:"2002", dept:"Wydział robotów", loc:"Hala 2", maker:"Fanuc", model:"M-20iA", warranty:"2025-06-20", status:"aktywny", op:"Operacyjna", parent:"Robot B", thumb:"pictures/m4_thumb.jpg" },
            { name: "Wózek widłowy", short:"WW-01", inv:"3001", dept:"Wydział maszyn", loc:"Magazyn", maker:"Linde", model:"E16", warranty:"2024-11-30", status:"nieaktywny", op:"Serwis", parent:"Robot B", thumb:"pictures/m5_thumb.jpg" }
        ]
    }
];

function statusClass(status) {
    const val = (status || "").toLowerCase();
    if (val.includes("nieaktywn")) return "status--inactive";
    if (val.includes("serwis") || val.includes("rezerwa") || val.includes("wycof")) return "status--service";
    return "status--active";
}

function renderGroup(group) {
    const parent = group.parent;
    const childCards = group.children.map(ch => `
        <div class="child-card">
            <div class="card-head">
                <img class="thumb" src="${ch.thumb}" alt="${ch.name}">
                <div>
                    <div class="title">${ch.name}</div>
                    <div class="meta">
                        <span>${ch.short}</span>
                        <span>Inv: ${ch.inv}</span>
                        <span>${ch.dept}</span>
                        <span>${ch.loc}</span>
                    </div>
                </div>
            </div>
            <div class="pill-row">
                <span class="pill">${ch.maker} ${ch.model}</span>
                <span class="pill">Gwarancja: ${ch.warranty}</span>
                <span class="pill ${statusClass(ch.status)}">${ch.status}</span>
                <span class="pill">${ch.op}</span>
                <span class="pill">Nadrzędna: ${ch.parent}</span>
            </div>
        </div>
    `).join("");

    return `
        <div class="group">
            <div class="parent-card">
                <div class="card-head">
                    <img class="thumb" src="${parent.thumb}" alt="${parent.name}">
                    <div>
                        <div class="title">${parent.name}</div>
                        <div class="meta">
                            <span>${parent.short}</span>
                            <span>Inv: ${parent.inv}</span>
                            <span>${parent.dept}</span>
                            <span>${parent.loc}</span>
                        </div>
                    </div>
                </div>
                <div class="tags">
                    <span class="tag ${statusClass(parent.status)}">${parent.status}</span>
                    <span class="tag">${parent.op}</span>
                    <span class="tag">${parent.maker} ${parent.model}</span>
                    <span class="tag">Gwarancja: ${parent.warranty}</span>
                </div>
            </div>
            <div class="children-grid">${childCards}</div>
        </div>
    `;
}

const groupsWrap = document.getElementById("groups");
if (groupsWrap) {
    groupsWrap.innerHTML = groups.map(renderGroup).join("");
}

// Aktywacje i tryb edycji + logika przycisków jak w oryginalnym scheme.html
const parentCards = () => Array.from(document.querySelectorAll(".parent-card"));
const childCards = () => Array.from(document.querySelectorAll(".child-card"));

function clearSelection() {
    parentCards().forEach(c => c.classList.remove("is-selected"));
    childCards().forEach(c => c.classList.remove("is-selected"));
}

function attachSelection() {
    parentCards().forEach(c => {
        c.addEventListener("click", () => {
            clearSelection();
            c.classList.add("is-selected");
        });
    });
    childCards().forEach(c => {
        c.addEventListener("click", () => {
            clearSelection();
            c.classList.add("is-selected");
        });
    });
}

attachSelection();

// Otwórz/Edytuj/Usuń z poziomu schematu
const openCardBtnScheme = document.getElementById("openCardBtnScheme");
const editCardBtnScheme = document.getElementById("editToggleBtn");
const deleteMachineBtnScheme = document.getElementById("deleteMachineBtnScheme");

if (openCardBtnScheme) {
    openCardBtnScheme.addEventListener("click", () => {
        window.location.href = "card.html?edit=0";
    });
}

let isEditing = false;
const editLabel = document.getElementById("editToggleLabel");

function setEditing(on) {
    isEditing = on;
    document.body.classList.toggle("is-editing", on);
    if (editLabel) editLabel.textContent = on ? "Zapisz" : "Edytuj";
}

if (editCardBtnScheme) {
    editCardBtnScheme.addEventListener("click", () => setEditing(!isEditing));
}
if (deleteMachineBtnScheme) {
    deleteMachineBtnScheme.addEventListener("click", () => {
        const confirmed = window.confirm("Czy na pewno chcesz usunąć maszynę, wariacie?");
        if (confirmed) {
            console.log("Maszyna została usunięta (logika do zaimplementowania).");
        }
    });
}

// Modale: ustawienia kolumn / filtry
const settingsToggle = document.getElementById("settingsToggle");
const settingsModal = document.getElementById("settingsModal");
const settingsClose = document.getElementById("settingsClose");

const filterToggle = document.getElementById("filterToggle");
const filterModal = document.getElementById("filterModal");
const filterClose = document.getElementById("filterClose");

function setModalVisibility(modalEl, open) {
    if (!modalEl) return;
    modalEl.classList.toggle("is-visible", open);
}

if (settingsToggle && settingsModal) {
    settingsToggle.addEventListener("click", () => setModalVisibility(settingsModal, true));
}
if (settingsClose && settingsModal) {
    settingsClose.addEventListener("click", () => setModalVisibility(settingsModal, false));
}
if (settingsModal) {
    settingsModal.addEventListener("click", (e) => {
        if (e.target === settingsModal) setModalVisibility(settingsModal, false);
    });
}

if (filterToggle && filterModal) {
    filterToggle.addEventListener("click", () => setModalVisibility(filterModal, true));
}
if (filterClose && filterModal) {
    filterClose.addEventListener("click", () => setModalVisibility(filterModal, false));
}
if (filterModal) {
    filterModal.addEventListener("click", (e) => {
        if (e.target === filterModal) setModalVisibility(filterModal, false);
    });
}

// Ikony eksportu (placeholder do rozbudowy)
const exportXlsBtn = document.querySelector(".icon-actions .icon-btn:nth-child(1)");
const exportPdfBtn = document.querySelector(".icon-actions .icon-btn:nth-child(2)");
if (exportXlsBtn) exportXlsBtn.addEventListener("click", () => console.log("Eksport XLS"));
if (exportPdfBtn) exportPdfBtn.addEventListener("click", () => console.log("Eksport PDF"));
</script>
</body>
</html>
