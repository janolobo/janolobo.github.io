<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <title>IronInsight layout test</title>
    <link rel="icon" type="image/svg+xml" href="svg-folder/TasksIcon.svg" />

    <!-- Główny styl -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="layout.css" />

    <style>
        #content-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            display: block;
            overflow: auto;
        }

        .frame--dark #content-frame {
            filter: invert(1) hue-rotate(180deg);
        }

        .sidebar-logo-btn {
            padding: 0;
            margin: 0;
            border: none;
            background: transparent;
            cursor: pointer;
        }

        /* Sidebar hover spójne z subtopbar */
        .frame-sidebar .icon-cell--light:hover { background: rgba(0,0,0,0.05); }
        .frame-sidebar .icon-cell--dark:hover  { background: rgba(255,255,255,0.15); }

        /* Subtopbar view buttons */
        .subtopbar {
            display: flex;
            align-items: center;
        }
        .subtopbar-view {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .view-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border: 1px solid rgba(0,0,0,0.12);
            border-radius: 8px;
            background: rgba(255,255,255,0.85);
            cursor: pointer;
            font-weight: 600;
            transition: background-color .15s ease, transform .1s ease, box-shadow .15s ease;
        }
        .view-btn:hover { background: rgba(0,0,0,0.05); }
        .view-btn:active { transform: scale(.98); box-shadow: 0 0 0 1px rgba(0,0,0,0.15) inset; }
        .view-btn img { width: 16px; height: 16px; display: block; }
        .view-btn.is-active {
            background: #000;
            color: #fff;
            border-color: #000;
        }
        .view-btn.is-active img { filter: invert(1) brightness(2); }

        /* Topbar ikony */
        .topbar-icons img {
            width: 24px;
            height: 24px;
        }
        .frame-logo {
            transition: opacity .2s ease;
        }
        .logo-pulse {
            opacity: 0.4;
        }
    </style>
</head>
<body>

<main class="page">

    <section id="frame" class="frame frame--light">

        <!-- SIDEBAR -->
        <div id="sidebar-main" class="frame-sidebar">
            <div class="sidebar-logo">
                <button id="logo-button" class="sidebar-logo-btn">
                    <img id="sidebar-logo-img" src="svg-folder/Logo3.svg" class="frame-logo" alt="Logo"/>
                </button>
            </div>
            <div class="sidebar-spacer-24"></div>

            <div class="icon-cell icon-cell--light sidebar-fixed" data-src="IconTable.html">
                <img src="svg-folder/ProgramIcon.svg" class="icon-img" />
                <span class="icon-label">IronInsight</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed">
                <img src="svg-folder/OrganisationIcon.svg" class="icon-img" />
                <span class="icon-label">Organizacja</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed" data-src="list.html">
                <img src="svg-folder/MaintenanceIcon.svg" class="icon-img" />
                <span class="icon-label">Utrzymanie ruchu</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed">
                <img src="svg-folder/ContractorsIcon.svg" class="icon-img" />
                <span class="icon-label">Kontrahenci</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed">
                <img src="svg-folder/DocumentsIcon.svg" class="icon-img" />
                <span class="icon-label">Dokumenty</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed">
                <img src="svg-folder/TechnologyIcon.svg" class="icon-img" />
                <span class="icon-label">Technologia</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed">
                <img src="svg-folder/TasksIcon.svg" class="icon-img" />
                <span class="icon-label">Zadania</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed" data-src="content.html">
                <img src="svg-folder/ProgramIcon.svg" class="icon-img" />
                <span class="icon-label">Program</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed" data-src="card.html">
                <img src="svg-folder/OrganisationIcon.svg" class="icon-img" />
                <span class="icon-label">Organizacja</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed" data-src="pdca.html">
                <img src="svg-folder/MaintenanceIcon.svg" class="icon-img" />
                <span class="icon-label">Utrzymanie ruchu</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed" data-src="node.html">
                <img src="svg-folder/ContractorsIcon.svg" class="icon-img" />
                <span class="icon-label">Kontrahenci</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed">
                <img src="svg-folder/DocumentsIcon.svg" class="icon-img" />
                <span class="icon-label">Dokumenty</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed">
                <img src="svg-folder/TechnologyIcon.svg" class="icon-img" />
                <span class="icon-label">Technologia</span>
            </div>

            <div class="icon-cell icon-cell--light sidebar-fixed">
                <img src="svg-folder/TasksIcon.svg" class="icon-img" />
                <span class="icon-label">Zadania</span>
            </div>

        </div>

        <!-- RIGHT AREA -->
        <div class="frame-right">

            <!-- TOPBAR -->
            <div class="topbar">
                <div class="frame-top-right topbar-icons">
                    <img src="svg-folder/xNotificationIcon.svg" alt="" />
                    <img src="svg-folder/xCalendarIcon.svg" alt="" />
                    <img src="svg-folder/xChatIcon.svg" alt="" />
                    <img src="svg-folder/xMyTasksIcon.svg" alt="" />
                    <img src="svg-folder/xSettingsIcon.svg" alt="" />
                    <img src="svg-folder/xAvatarIcon.svg" alt="" />
                </div>
            </div>

            <div class="topbar-spacer"></div>

            <!-- SUBTOPBAR -->
            <div id="subtopbar-main" class="subtopbar"></div>

            <!-- CONTENT -->
            <div class="content">
                <iframe id="content-frame" src="dashboard.html" allow="input-prompting"></iframe>
            </div>

            <!-- BOTTOM CONTROLS -->
            <div class="bottom-controls">
                Czcionka:
                <select id="font-select" class="font-select"></select>

                Rozmiar:
                <input id="font-size" class="font-size-input" type="number" min="10" max="32"/>

                Szarość:
                <input id="font-opacity" class="font-opacity-input" type="number" min="0" max="100"/>

                <button id="refresh" class="refresh-button">REFRESH</button>
                <button id="theme-toggle" class="refresh-button">DARK</button>
                <button class="layout-toggle" data-frame="frame">LAYOUT</button>
            </div>

        </div>

        <!-- LAYOUT OVERLAY -->
        <div class="layout-overlay"></div>

    </section>

</main>



<!-- ============================================================
   SCRIPT
============================================================ -->
<script>
/* ============================================================
   STAŁE IKONY SIDEBAR
============================================================ */
document.querySelectorAll(".sidebar-fixed").forEach(cell => {
    cell.addEventListener("click", () => {
        document.querySelectorAll(".icon-cell--selected")
            .forEach(el => el.classList.remove("icon-cell--selected"));

        cell.classList.add("icon-cell--selected");
        pulseLogo();

        const file = cell.dataset.src;
        if (file) {
            const frameEl = document.getElementById("content-frame");
            if (file === "pdca.html") {
                frameEl.src = "List.html";
                const wrap = subtopbarEl.querySelector(".subtopbar-view");
                const btnList = wrap?.querySelector('.view-btn[data-src="List.html"]');
                if (btnList) {
                    wrap.querySelectorAll(".view-btn").forEach(b => b.classList.remove("is-active"));
                    btnList.classList.add("is-active");
                }
            } else {
                frameEl.src = file;
                const wrap = subtopbarEl.querySelector(".subtopbar-view");
                if (wrap) wrap.querySelectorAll(".view-btn").forEach(b => b.classList.remove("is-active"));
            }
        }

        loadRandomIconsForSubtopbar(subtopbarEl, currentTheme === "dark");
        initViewButtons(subtopbarEl.querySelector(".subtopbar-view"));
    });
});

const sidebarFixedCells = document.querySelectorAll(".sidebar-fixed");
const logoImg = document.getElementById("sidebar-logo-img");

function pulseLogo() {
    if (!logoImg) return;
    logoImg.classList.remove("logo-pulse");
    void logoImg.offsetWidth; // restart animation
    logoImg.classList.add("logo-pulse");
    setTimeout(() => logoImg.classList.remove("logo-pulse"), 200);
}


/* ============================================================
   SUBTOPBAR LOSOWY
============================================================ */
const ICONS_PATH = "svg-folder/";
const svgFiles = [
  "5WhyIcon.svg","8DReportIcon.svg","BookmarksIcon.svg","CalendarIcon.svg",
  "ChatIcon.svg","CompetencesIcon.svg","ComponentsIcon.svg","ContractorsIcon.svg",
  "CostsSummaryIcon.svg","CustomersIcon.svg","DepartmentsIcon.svg",
  "DescriptionFieldIcon.svg","DocumentsIcon.svg","EmployeesIcon.svg",
  "EnclosurementAddIcon.svg","EnclosurementIcon.svg","ExcelIcon.svg",
  "ExclamationIcon.svg","FileIcon.svg","HRIcon.svg","ImprovementIcon.svg",
  "IshikawaIcon.svg","ListIcon.svg","LocationsIcon.svg","MachinesIcon.svg",
  "MaintenanceIcon.svg","MiniCalendarIcon.svg","NotificationsIcon_mono.svg",
  "OrganisationIcon.svg","PDFIcon.svg","PictureIcon.svg","PositionsIcon.svg",
  "PrivateTaskIcon.svg","ProductionIcon.svg","ProgramIcon.svg","PromotIcon.svg",
  "PurposeIcon.svg","QmsProcessesIcon.svg","QualityAlertIcon.svg",
  "RootcauseIcon.svg","SettingsIcon.svg","SimpleSubtaskIcon.svg",
  "SortingIcon.svg","SubtaskIcon.svg","SuppliersIcon.svg","TasksIcon.svg",
  "TeamIcon.svg","TechnologyIcon.svg","UsersIcon.svg","ValidationIcon.svg",
  "WorkstationsIcon.svg","xAvatarIcon.svg","xCalendarIcon.svg","xChatIcon.svg",
  "xDeleteIcon.svg","xExportPDFIcon.svg","xExportXLSIcon.svg",
  "xFileUploadIcon.svg","xNotificationIcon.svg","xSettingsIcon.svg",
  "xSettingsListIcon.svg"
];

function shuffle(a) {
  let arr = [...a];
  for (let i = arr.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function createCell(iconName, dark) {
  const cell = document.createElement("div");
  cell.className = "icon-cell " + (dark ? "icon-cell--dark" : "icon-cell--light");

  const img = document.createElement("img");
  img.className = "icon-img";
  img.src = ICONS_PATH + iconName;

  const label = document.createElement("span");
  label.className = "icon-label";
  label.textContent = iconName.replace(".svg","");

  cell.append(img, label);
  return cell;
}

function createViewOptions() {
  const wrap = document.createElement("div");
  wrap.className = "subtopbar-view";
  wrap.innerHTML = `
    <button class="view-btn" type="button" data-src="List.html">
      <img src="${ICONS_PATH}ListViewIcon.svg" alt="">
      <span>Lista</span>
    </button>
    <button class="view-btn" type="button" data-src="scheme.html">
      <img src="${ICONS_PATH}SchemeViewIcon.svg" alt="">
      <span>Schemat</span>
    </button>
    <button class="view-btn" type="button" data-src="Card.html">
      <img src="${ICONS_PATH}CardViewIcon.svg" alt="">
      <span>Karta</span>
    </button>
  `;
  return wrap;
}
function initViewButtons(wrap) {
  const frameEl = document.getElementById("content-frame");
  if (!wrap || !frameEl) return;
  const btns = Array.from(wrap.querySelectorAll(".view-btn"));
  function setActive(target) {
    btns.forEach(b => b.classList.remove("is-active"));
    target.classList.add("is-active");
  }
  btns.forEach(btn => {
    btn.addEventListener("click", () => {
      const src = btn.dataset.src;
      if (src) frameEl.src = src;
      setActive(btn);
    });
  });
}

/* ============================================================
   LOGO BUTTON CYCLE
============================================================ */
const logoButton = document.getElementById("logo-button");
const logoFiles = ["Logo1.svg", "Logo2.svg", "Logo3.svg"];
let logoIndex = 0;

if (logoButton && logoImg) {
  logoButton.addEventListener("click", () => {
    logoIndex = (logoIndex + 1) % logoFiles.length;
    logoImg.src = "svg-folder/" + logoFiles[logoIndex];
    const frameEl = document.getElementById("content-frame");
    if (frameEl) frameEl.src = "dashboard.html";
  });
}

function loadRandomIconsForSubtopbar(subbar, dark) {
  const pool = svgFiles.filter(name => !name.startsWith("x"));
  const shuffled = shuffle(pool).slice(0, 7);
  subbar.innerHTML = "";
  shuffled.forEach(i => subbar.appendChild(createCell(i, dark)));

  const cells = subbar.querySelectorAll(".icon-cell");
  cells.forEach(cell => {
    cell.addEventListener("click", () => {
      cells.forEach(c => c.classList.remove("icon-cell--selected"));
      cell.classList.add("icon-cell--selected");
    });
  });

  subbar.appendChild(createViewOptions());
  initViewButtons(subbar.querySelector(".subtopbar-view"));
}


/* ============================================================
   THEME + FONT CONTROLS
============================================================ */
const fontSelect       = document.getElementById("font-select");
const fontSizeInput    = document.getElementById("font-size");
const fontOpacityInput = document.getElementById("font-opacity");
const refreshBtn       = document.getElementById("refresh");
const themeToggleBtn   = document.getElementById("theme-toggle");
const frame            = document.getElementById("frame");
const subtopbarEl      = document.getElementById("subtopbar-main");
let currentTheme = localStorage.getItem("uiTheme") || "light";

const FRAME_FONTS = [
    "FrutigerNeue Bold","FrutigerNeue Light",
    "Inconsolata Condensed Medium","Inconsolata Condensed Regular",
    "Inconsolata Condensed SemiBold",
    "Open Sans","Samsung Sans","Satoshi","Inter 18pt",
    "Geograph","DieGrotesk","Manrope","Larke Neue Thin",
    "Liberation Sans","Libra Sans","Opening Hours Sans",
    "Sora","Poppins Light","Plus Jakarta Sans","Nimbus Sans",
    "Ubuntu Light","Roboto","Segoe UI Thin",
    "Cantarell","Exo 2","Aileron Light","Montserrat Light"
];

function fillFontSelect() {
    fontSelect.innerHTML = FRAME_FONTS
        .map(f => `<option value="${f}">${f}</option>`).join("");
}

function applyFrameSettings(settings) {
    frame.style.setProperty("--frame-font-family", settings.font);
    frame.style.setProperty("--frame-font-size", settings.size + "px");
    frame.style.setProperty("--frame-opacity", settings.opacity / 100);
}

function refreshFrameSettingsFromUI() {
    const settings = {
        font: fontSelect.value,
        size: parseInt(fontSizeInput.value),
        opacity: parseInt(fontOpacityInput.value)
    };
    applyFrameSettings(settings);
}

function initFrameControls() {
    fillFontSelect();
    fontSelect.value = "Open Sans";
    fontSizeInput.value = 14;
    fontOpacityInput.value = 100;
    applyFrameSettings({ font:"Open Sans", size:14, opacity:100 });
    refreshBtn.addEventListener("click", refreshFrameSettingsFromUI);
}

function updateThemeClasses() {
    if (currentTheme === "dark") {
        frame.classList.remove("frame--light");
        frame.classList.add("frame--dark");
        themeToggleBtn.textContent = "LIGHT";
    } else {
        frame.classList.remove("frame--dark");
        frame.classList.add("frame--light");
        themeToggleBtn.textContent = "DARK";
    }
}

themeToggleBtn.addEventListener("click", () => {
    currentTheme = currentTheme === "dark" ? "light" : "dark";
    localStorage.setItem("uiTheme", currentTheme);
    updateThemeClasses();
    loadRandomIconsForSubtopbar(subtopbarEl, currentTheme === "dark");
});


/* ============================================================
   LAYOUT — STABILNA WERSJA (zero lagów)
============================================================ */

const layoutOverlay = document.querySelector(".layout-overlay");

function buildLayoutOverlay() {
    if (!frame.classList.contains("frame--show-layout")) {
        layoutOverlay.innerHTML = "";
        return;
    }

    layoutOverlay.innerHTML = "";
    const rect = frame.getBoundingClientRect();
    const grid = 16;

    const cols = Math.floor(rect.width / grid);
    const rows = Math.floor(rect.height / grid);

    for (let i = 0; i <= rows; i++) {
        const h = document.createElement("div");
        h.className = "layout-grid-line-h";
        h.style.top = (i * grid) + "px";
        if (i % 2 === 0) h.classList.add("thick");
        layoutOverlay.appendChild(h);
    }

    for (let i = 0; i <= cols; i++) {
        const v = document.createElement("div");
        v.className = "layout-grid-line-v";
        v.style.left = (i * grid) + "px";
        if (i % 2 === 0) v.classList.add("thick");
        layoutOverlay.appendChild(v);
    }

    const highlight = [
        ".frame-sidebar",
        ".topbar",
        ".subtopbar",
        ".content",
        ".bottom-controls"
    ];

    highlight.forEach(sel => {
        const el = frame.querySelector(sel);
        if (!el) return;

        const r = el.getBoundingClientRect();
        const box = document.createElement("div");
        box.className = "layout-box";

        box.style.left = (r.left - rect.left) + "px";
        box.style.top = (r.top - rect.top) + "px";
        box.style.width = r.width + "px";
        box.style.height = r.height + "px";

        const cs = getComputedStyle(el);
        const label = document.createElement("div");
        label.className = "layout-label";
        label.textContent = `${sel.replace(".", "")} | ${Math.round(r.width)}x${Math.round(r.height)} | p:${cs.paddingTop}/${cs.paddingRight}/${cs.paddingBottom}/${cs.paddingLeft} | m:${cs.marginTop}/${cs.marginRight}/${cs.marginBottom}/${cs.marginLeft}`;
        box.appendChild(label);

        layoutOverlay.appendChild(box);
    });
}

new MutationObserver(() => buildLayoutOverlay()).observe(frame, {
    attributes: true,
    attributeFilter: ["class"]
});

document.querySelectorAll(".layout-toggle").forEach(btn => {
    btn.addEventListener("click", () => {
        frame.classList.toggle("frame--show-layout");
        buildLayoutOverlay();
    });
});

window.addEventListener("resize", buildLayoutOverlay);


/* ============================================================
   START
============================================================ */
updateThemeClasses();
initFrameControls();
loadRandomIconsForSubtopbar(subtopbarEl, currentTheme === "dark");
buildLayoutOverlay();

</script>

</body>
</html>
